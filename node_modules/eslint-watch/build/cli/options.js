"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash.unionwith"));

var _optionator = _interopRequireDefault(require("optionator"));

var _lodash2 = _interopRequireDefault(require("lodash.kebabcase"));

var _logger = require("../logger");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { keys.push.apply(keys, Object.getOwnPropertySymbols(object)); } if (enumerableOnly) keys = keys.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const logger = (0, _logger.createLogger)('options');
const settings = {
  prepend: 'esw [options] [file.js ...] [dir ...]',
  concatRepeatedArrays: true,
  mergeRepeatedObjects: true
};
const defaultOptions = [{
  heading: 'ESW Options'
}, {
  option: 'help',
  alias: 'h',
  type: 'Boolean',
  description: 'Show help'
}, {
  option: 'watch',
  alias: 'w',
  type: 'Boolean',
  description: 'Enable file watch'
}, {
  option: 'changed',
  type: 'Boolean',
  description: 'Enables single file linting while watch is enabled'
}, {
  option: 'clear',
  type: 'Boolean',
  description: 'Clear terminal when running lint'
}, {
  option: 'version',
  type: 'Boolean',
  alias: 'v',
  description: 'Prints Eslint-Watch Version'
}, {
  option: 'versions',
  type: 'Boolean',
  description: 'Prints Eslint-Watch and Eslint Versions'
}, {
  option: 'watch-ignore',
  type: 'RegExp',
  description: 'Regex string of folders to ignore when watching - default: /.git|node_modules|bower_components/'
}, {
  option: 'watch-delay',
  type: 'Int',
  description: 'Delay(ms) for watcher to wait to trigger re-lint',
  default: '300'
}, {
  heading: 'Basic configuration'
}, {
  option: 'ext',
  type: '[String]',
  description: 'Specify JavaScript file extensions',
  default: '.js'
}];

function areEqual(opt1, opt2) {
  if (opt1.heading && opt2.heading) {
    return opt1.heading === opt2.heading;
  }

  return opt1.alias === opt2.alias && opt1.option === opt2.option && opt1.type === opt2.type;
}

var _default = {
  get eswOptions() {
    return [...defaultOptions];
  },

  createOptions(eswOptions, eslintOptions = []) {
    const mergedOptions = (0, _lodash.default)(eswOptions, eslintOptions, areEqual);
    logger.debug(mergedOptions);
    const opsor = (0, _optionator.default)(_objectSpread({}, settings, {
      options: mergedOptions
    }));
    return {
      helpText: opsor.generateHelp(),

      parse(rawArgs) {
        const options = opsor.parse(rawArgs, {
          slice: 0
        });
        const dirs = options._;

        if (dirs.length === 0) {
          dirs.push(_path.default.resolve('.'));
        }

        options._ = dirs;
        return options;
      }

    };
  },

  getCli(options) {
    const eswKeys = ['watch', 'versions', 'version', 'clear', 'changed', 'watchIgnore', 'watchDelay'];
    return Object.entries(options).reduce((acc, [key, value]) => {
      if (eswKeys.includes(key)) {
        return acc;
      }

      if (key === '_') {
        return acc;
      }

      if (key === 'rule') {
        Object.keys(value).forEach(ruleKey => {
          acc.flags.push('--rule', `${ruleKey}: ${JSON.stringify(value[ruleKey]).replace(/"/g, '')}`);
        });
        return acc;
      }

      if (typeof value === 'boolean') {
        acc.flags.push(`--${value ? '' : 'no-'}${(0, _lodash2.default)(key)}`);
      } else {
        acc.flags.push(`--${(0, _lodash2.default)(key)}`);
        acc.flags.push(value);
      }

      return acc;
    }, {
      flags: [],
      dirs: options._ || []
    });
  }

};
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGkvb3B0aW9ucy5qcyJdLCJuYW1lcyI6WyJsb2dnZXIiLCJzZXR0aW5ncyIsInByZXBlbmQiLCJjb25jYXRSZXBlYXRlZEFycmF5cyIsIm1lcmdlUmVwZWF0ZWRPYmplY3RzIiwiZGVmYXVsdE9wdGlvbnMiLCJoZWFkaW5nIiwib3B0aW9uIiwiYWxpYXMiLCJ0eXBlIiwiZGVzY3JpcHRpb24iLCJkZWZhdWx0IiwiYXJlRXF1YWwiLCJvcHQxIiwib3B0MiIsImVzd09wdGlvbnMiLCJjcmVhdGVPcHRpb25zIiwiZXNsaW50T3B0aW9ucyIsIm1lcmdlZE9wdGlvbnMiLCJkZWJ1ZyIsIm9wc29yIiwib3B0aW9ucyIsImhlbHBUZXh0IiwiZ2VuZXJhdGVIZWxwIiwicGFyc2UiLCJyYXdBcmdzIiwic2xpY2UiLCJkaXJzIiwiXyIsImxlbmd0aCIsInB1c2giLCJwYXRoIiwicmVzb2x2ZSIsImdldENsaSIsImVzd0tleXMiLCJPYmplY3QiLCJlbnRyaWVzIiwicmVkdWNlIiwiYWNjIiwia2V5IiwidmFsdWUiLCJpbmNsdWRlcyIsImtleXMiLCJmb3JFYWNoIiwicnVsZUtleSIsImZsYWdzIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlcGxhY2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7OztBQUVBLE1BQU1BLE1BQU0sR0FBRywwQkFBYSxTQUFiLENBQWY7QUFFQSxNQUFNQyxRQUFRLEdBQUc7QUFDZkMsRUFBQUEsT0FBTyxFQUFFLHVDQURNO0FBRWZDLEVBQUFBLG9CQUFvQixFQUFFLElBRlA7QUFHZkMsRUFBQUEsb0JBQW9CLEVBQUU7QUFIUCxDQUFqQjtBQU1BLE1BQU1DLGNBQWMsR0FBRyxDQUNyQjtBQUNFQyxFQUFBQSxPQUFPLEVBQUU7QUFEWCxDQURxQixFQUlyQjtBQUNFQyxFQUFBQSxNQUFNLEVBQUUsTUFEVjtBQUVFQyxFQUFBQSxLQUFLLEVBQUUsR0FGVDtBQUdFQyxFQUFB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aUIsU0FBckIsRUFBZ0M7QUFDOUJGLFFBQUFBLEdBQUcsQ0FBQ08sS0FBSixDQUFVZixJQUFWLENBQWdCLEtBQUlVLEtBQUssR0FBRyxFQUFILEdBQVEsS0FBTSxHQUFFLHNCQUFNRCxHQUFOLENBQVcsRUFBcEQ7QUFDRCxPQUZELE1BRU87QUFDTEQsUUFBQUEsR0FBRyxDQUFDTyxLQUFKLENBQVVmLElBQVYsQ0FBZ0IsS0FBSSxzQkFBTVMsR0FBTixDQUFXLEVBQS9CO0FBQ0FELFFBQUFBLEdBQUcsQ0FBQ08sS0FBSixDQUFVZixJQUFWLENBQWVVLEtBQWY7QUFDRDs7QUFFRCxhQUFPRixHQUFQO0FBQ0QsS0ExQkksRUEyQkw7QUFDRU8sTUFBQUEsS0FBSyxFQUFFLEVBRFQ7QUFFRWxCLE1BQUFBLElBQUksRUFBRU4sT0FBTyxDQUFDTyxDQUFSLElBQWE7QUFGckIsS0EzQkssQ0FBUDtBQWdDRDs7QUE1RFksQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHVuaW9ud2l0aCBmcm9tICdsb2Rhc2gudW5pb253aXRoJztcbmltcG9ydCBvcHRpb25hdG9yIGZyb20gJ29wdGlvbmF0b3InO1xuaW1wb3J0IGtlYmFiIGZyb20gJ2xvZGFzaC5rZWJhYmNhc2UnO1xuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyIH0gZnJvbSAnLi4vbG9nZ2VyJztcblxuY29uc3QgbG9nZ2VyID0gY3JlYXRlTG9nZ2VyKCdvcHRpb25zJyk7XG5cbmNvbnN0IHNldHRpbmdzID0ge1xuICBwcmVwZW5kOiAnZXN3IFtvcHRpb25zXSBbZmlsZS5qcyAuLi5dIFtkaXIgLi4uXScsXG4gIGNvbmNhdFJlcGVhdGVkQXJyYXlzOiB0cnVlLFxuICBtZXJnZVJlcGVhdGVkT2JqZWN0czogdHJ1ZSxcbn07XG5cbmNvbnN0IGRlZmF1bHRPcHRpb25zID0gW1xuICB7XG4gICAgaGVhZGluZzogJ0VTVyBPcHRpb25zJyxcbiAgfSxcbiAge1xuICAgIG9wdGlvbjogJ2hlbHAnLFxuICAgIGFsaWFzOiAnaCcsXG4gICAgdHlwZTogJ0Jvb2xlYW4nLFxuICAgIGRlc2NyaXB0aW9uOiAnU2hvdyBoZWxwJyxcbiAgfSxcbiAge1xuICAgIG9wdGlvbjogJ3dhdGNoJyxcbiAgICBhbGlhczogJ3cnLFxuICAgIHR5cGU6ICdCb29sZWFuJyxcbiAgICBkZXNjcmlwdGlvbjogJ0VuYWJsZSBmaWxlIHdhdGNoJyxcbiAgfSxcbiAge1xuICAgIG9wdGlvbjogJ2NoYW5nZWQnLFxuICAgIHR5cGU6ICdCb29sZWFuJyxcbiAgICBkZXNjcmlwdGlvbjogJ0VuYWJsZXMgc2luZ2xlIGZpbGUgbGludGluZyB3aGlsZSB3YXRjaCBpcyBlbmFibGVkJyxcbiAgfSxcbiAge1xuICAgIG9wdGlvbjogJ2NsZWFyJyxcbiAgICB0eXBlOiAnQm9vbGVhbicsXG4gICAgZGVzY3JpcHRpb246ICdDbGVhciB0ZXJtaW5hbCB3aGVuIHJ1bm5pbmcgbGludCcsXG4gIH0sXG4gIHtcbiAgICBvcHRpb246ICd2ZXJzaW9uJyxcbiAgICB0eXBlOiAnQm9vbGVhbicsXG4gICAgYWxpYXM6ICd2JyxcbiAgICBkZXNjcmlwdGlvbjogJ1ByaW50cyBFc2xpbnQtV2F0Y2ggVmVyc2lvbicsXG4gIH0sXG4gIHtcbiAgICBvcHRpb246ICd2ZXJzaW9ucycsXG4gICAgdHlwZTogJ0Jvb2xlYW4nLFxuICAgIGRlc2NyaXB0aW9uOiAnUHJpbnRzIEVzbGludC1XYXRjaCBhbmQgRXNsaW50IFZlcnNpb25zJyxcbiAgfSxcbiAge1xuICAgIG9wdGlvbjogJ3dhdGNoLWlnbm9yZScsXG4gICAgdHlwZTogJ1JlZ0V4cCcsXG4gICAgZGVzY3JpcHRpb246ICdSZWdleCBzdHJpbmcgb2YgZm9sZGVycyB0byBpZ25vcmUgd2hlbiB3YXRjaGluZyAtIGRlZmF1bHQ6IC8uZ2l0fG5vZGVfbW9kdWxlc3xib3dlcl9jb21wb25lbnRzLycsXG4gIH0sXG4gIHtcbiAgICBvcHRpb246ICd3YXRjaC1kZWxheScsXG4gICAgdHlwZTogJ0ludCcsXG4gICAgZGVzY3JpcHRpb246ICdEZWxheShtcykgZm9yIHdhdGNoZXIgdG8gd2FpdCB0byB0cmlnZ2VyIHJlLWxpbnQnLFxuICAgIGRlZmF1bHQ6ICczMDAnLFxuICB9LFxuICB7XG4gICAgaGVhZGluZzogJ0Jhc2ljIGNvbmZpZ3VyYXRpb24nLFxuICB9LFxuICB7XG4gICAgb3B0aW9uOiAnZXh0JyxcbiAgICB0eXBlOiAnW1N0cmluZ10nLFxuICAgIGRlc2NyaXB0aW9uOiAnU3BlY2lmeSBKYXZhU2NyaXB0IGZpbGUgZXh0ZW5zaW9ucycsXG4gICAgZGVmYXVsdDogJy5qcycsXG4gIH0sXG5dO1xuXG5mdW5jdGlvbiBhcmVFcXVhbChvcHQxLCBvcHQyKSB7XG4gIGlmIChvcHQxLmhlYWRpbmcgJiYgb3B0Mi5oZWFkaW5nKSB7XG4gICAgcmV0dXJuIG9wdDEuaGVhZGluZyA9PT0gb3B0Mi5oZWFkaW5nO1xuICB9XG4gIHJldHVybiBvcHQxLmFsaWFzID09PSBvcHQyLmFsaWFzICYmIG9wdDEub3B0aW9uID09PSBvcHQyLm9wdGlvbiAmJiBvcHQxLnR5cGUgPT09IG9wdDIudHlwZTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBnZXQgZXN3T3B0aW9ucygpIHtcbiAgICByZXR1cm4gWy4uLmRlZmF1bHRPcHRpb25zXTtcbiAgfSxcbiAgY3JlYXRlT3B0aW9ucyhlc3dPcHRpb25zLCBlc2xpbnRPcHRpb25zID0gW10pIHtcbiAgICBjb25zdCBtZXJnZWRPcHRpb25zID0gdW5pb253aXRoKGVzd09wdGlvbnMsIGVzbGludE9wdGlvbnMsIGFyZUVxdWFsKTtcbiAgICBsb2dnZXIuZGVidWcobWVyZ2VkT3B0aW9ucyk7XG4gICAgY29uc3Qgb3Bzb3IgPSBvcHRpb25hdG9yKHsgLi4uc2V0dGluZ3MsIG9wdGlvbnM6IG1lcmdlZE9wdGlvbnMgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaGVscFRleHQ6IG9wc29yLmdlbmVyYXRlSGVscCgpLFxuICAgICAgcGFyc2UocmF3QXJncykge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gb3Bzb3IucGFyc2UocmF3QXJncywgeyBzbGljZTogMCB9KTtcbiAgICAgICAgY29uc3QgZGlycyA9IG9wdGlvbnMuXztcblxuICAgICAgICBpZiAoZGlycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBkaXJzLnB1c2gocGF0aC5yZXNvbHZlKCcuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgb3B0aW9ucy5fID0gZGlycztcblxuICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICAgIH0sXG4gICAgfTtcbiAgfSxcbiAgZ2V0Q2xpKG9wdGlvbnMpIHtcbiAgICBjb25zdCBlc3dLZXlzID0gWyd3YXRjaCcsICd2ZXJzaW9ucycsICd2ZXJzaW9uJywgJ2NsZWFyJywgJ2NoYW5nZWQnLCAnd2F0Y2hJZ25vcmUnLCAnd2F0Y2hEZWxheSddO1xuXG4gICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKG9wdGlvbnMpLnJlZHVjZShcbiAgICAgIChhY2MsIFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICBpZiAoZXN3S2V5cy5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChrZXkgPT09ICdfJykge1xuICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoa2V5ID09PSAncnVsZScpIHtcbiAgICAgICAgICBPYmplY3Qua2V5cyh2YWx1ZSkuZm9yRWFjaCgocnVsZUtleSkgPT4ge1xuICAgICAgICAgICAgYWNjLmZsYWdzLnB1c2goJy0tcnVsZScsIGAke3J1bGVLZXl9OiAke0pTT04uc3RyaW5naWZ5KHZhbHVlW3J1bGVLZXldKS5yZXBsYWNlKC9cIi9nLCAnJyl9YCk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgYWNjLmZsYWdzLnB1c2goYC0tJHt2YWx1ZSA/ICcnIDogJ25vLSd9JHtrZWJhYihrZXkpfWApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFjYy5mbGFncy5wdXNoKGAtLSR7a2ViYWIoa2V5KX1gKTtcbiAgICAgICAgICBhY2MuZmxhZ3MucHVzaCh2YWx1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgZmxhZ3M6IFtdLFxuICAgICAgICBkaXJzOiBvcHRpb25zLl8gfHwgW10sXG4gICAgICB9XG4gICAgKTtcbiAgfSxcbn07XG4iXX0=